//This script installs Microsoft Monitoring Agent Arc Extension for a single Azure Stack HCI Cluster.

# Initialize subscriptionId, resourceGroup ,tenantId and settings
$subscriptionId = "test-subscription"
$resourceGroup = "test-rg"
$tenantId = ""
$settings= "path to workspace_mma.json"
$protectedSetting = "path to workspacekey_mma.json"

# Logging in to Azure using the tenant ID
$_ = az login --tenant $tenantId
# Setting the subscription ID
$_ = az account set -s  $subscriptionId

# Installing the MMA extension with the specified parameters
az stack-hci extension create --arc-setting-name "default" --extension-name "MicrosoftMonitoringAgent" --resource-group $using:resourceGroup --auto-upgrade true --publisher "Microsoft.EnterpriseCloud.Monitoring" --type "MicrosoftMonitoringAgent" --settings @$using:settings  --protected-settings @$using:protectedSetting --type-handler-version "1.10" 
	
