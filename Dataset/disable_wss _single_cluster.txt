# This script disables wss diagnostics for a single Azure Stack HCI cluster.

# Code starts here

# Define subscription, resourceGroup and tenantId
$subscription = ""
$resourceGroup = ""
$tenantId = ""

# Use a specified tenant ID to log in.
$login = az login --tenant $tenantId
# Change the active subscription to the specified subscription ID.
az account set -s  $subscriptionId

# Update the properties of the cluster
Invoke-AzRestMethod -Method PUT -SubscriptionId $subscription -ResourceGroupName $resourceGroup -ResourceProviderName "Microsoft.AzureStackHCI" -ResourceType "cluster" -Name $cluster.Name -ApiVersion "2023-02-01" -Payload '{
    "properties": {
        "desiredProperties": {
            "windowsServerSubscription": "Disabled",
            "diagnosticLevel": "Basic"
        }
    },
    "tags": {
        "DoNotDelete": "true"
    },
    "location": "eastus2euap",
}
